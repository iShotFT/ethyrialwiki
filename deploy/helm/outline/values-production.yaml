# Production environment values for outline.
replicaCount:
  web: 2
  worker: 2
  collaboration: 2

# Enable storage class creation for K3s
storageClasses:
  create: true

# Authentication configuration
auth:
  discord:
    enabled: true
    # Credentials stored in Kubernetes secret

# Disable other authentication methods
auth.google.enabled: false
auth.slack.enabled: false
auth.oidc.enabled: false

# Enable autoscaling for production
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Pod annotations for K3s integration
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "3000"

# Resources for production
resources:
  web:
    limits:
      cpu: 2000m
      memory: 6Gi
    requests:
      cpu: 500m
      memory: 1Gi
  worker:
    limits:
      cpu: 2000m
      memory: 6Gi
    requests:
      cpu: 500m
      memory: 1Gi
  collaboration:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 200m
      memory: 512Mi

# Larger persistence sizes for production
persistence:
  enabled: true
  size: 50Gi
  storageClass: "local-path" # K3s local-path provisioner

postgresql:
  enabled: true
  primary:
    persistence:
      size: 20Gi
      storageClassName: "local-path" # K3s local-path provisioner
  auth:
    username: outline
    password: outline
    database: outline
    enablePostgresUser: true
    postgresPassword: outline

redis:
  enabled: true
  master:
    persistence:
      size: 10Gi
      storageClassName: "local-path" # K3s local-path provisioner
  auth:
    enabled: false

# Enable ingress for production
ingress:
  enabled: true
  className: "nginx" # This matches our K3s nginx ingress class
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    kubernetes.io/tls-acme: "true" # For cert-manager integration
  host: ethyrial.wiki
  path: /
  pathType: Prefix
  tls:
    enabled: true
    secretName: outline-production-tls

# Environment variables for production
env:
  URL: "https://ethyrial.wiki"
  DEBUG: "false"
  LOG_LEVEL: "info"
  ENABLE_UPDATES: false
  NODE_ENV: "production"
  FORCE_HTTPS: true
  RATE_LIMITER_ENABLED: true
  # S3 Storage configuration
  FILE_STORAGE: "s3"
  AWS_S3_UPLOAD_BUCKET_NAME: "ethyrial-wiki"
  AWS_S3_UPLOAD_BUCKET_URL: "https://s3.eu-central-1.amazonaws.com"
  AWS_REGION: "eu-central-1"
  PGSSLMODE: "disable"

# Add host networking for compatibility
hostNetwork: false # Changed to false as we're using node ports

# Add DNS config for K3s
dnsConfig:
  nameservers:
    - 10.43.0.10 # K3s CoreDNS service IP
  searches:
    - ethyrial-production.svc.cluster.local
    - svc.cluster.local
    - cluster.local

# Reference existing secrets (created according to README instructions)
existingSecrets:
  auth: "outline-auth"
  keys: "outline-keys"
  s3: "outline-s3"
